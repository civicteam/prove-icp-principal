import { TextEncoder, TextDecoder } from 'util';
Object.assign(global, { TextDecoder, TextEncoder });

import { verify, create } from '../src';

const messageFixture = "37e243bc2112843ef7174733a80cd7c24ac4ed5e4dd46007d9c72ee9fb9b1b01";

const principal = 'kmqd3-gcy52-fuveh-up26m-qva6p-uzz2j-hhfn2-boog2-u2g2z-mjzhj-zqe';
const proofJWTFixture =
  'eyJleHBpcmVzIjoiMjAyNC0wNi0yOFQxNDozOTozMy4yNDdaIiwibWVzc2FnZSI6IjM3ZTI0M2JjMjExMjg0M2VmNzE3NDczM2E4MGNkN2MyNGFjNGVkNWU0ZGQ0NjAwN2Q5YzcyZWU5ZmI5YjFiMDEifQ==.eyJkZWxlZ2F0aW9ucyI6W3siZGVsZWdhdGlvbiI6eyJwdWJrZXkiOiI3YjIyNjU3ODcwNjk3MjY1NzMyMjNhMjIzMjMwMzIzNDJkMzAzNjJkMzIzODU0MzEzNDNhMzMzOTNhMzMzMzJlMzIzNDM3NWEyMjJjMjI2ZDY1NzM3MzYxNjc2NTIyM2EyMjMzMzc2NTMyMzQzMzYyNjMzMjMxMzEzMjM4MzQzMzY1NjYzNzMxMzczNDM3MzMzMzYxMzgzMDYzNjQzNzYzMzIzNDYxNjMzNDY1NjQzNTY1MzQ2NDY0MzQzNjMwMzAzNzY0Mzk2MzM3MzI2NTY1Mzk2NjYyMzk2MjMxNjIzMDMxMjI3ZCIsImV4cGlyYXRpb24iOiIxN2RkMzM1NjI5M2Q5ZTY3In0sInNpZ25hdHVyZSI6ImQ5ZDlmN2EyNmI2MzY1NzI3NDY5NjY2OTYzNjE3NDY1NTkwNGFmZDlkOWY3YTM2NDc0NzI2NTY1ODMwMTgzMDE4MzAxODIwNDU4MjBmZTliMGU5YzA1M2RmZWIzMGNlYWVmZWY3YjNmYjQwOTBlNGYwZDFjMDVlOWQ5YzFkM2Y1YmQ5ZTA5ZGY0MjYzODMwMjQ4NjM2MTZlNjk3Mzc0NjU3MjgzMDE4MzAxODMwMTgzMDI0YTAwMDAwMDAwMDAwMDAwMDcwMTAxODMwMTgzMDE4MzAyNGU2MzY1NzI3NDY5NjY2OTY1NjQ1ZjY0NjE3NDYxODIwMzU4MjAwMDBmMzg0YjA1MWEwYTFjZWVmYTJlODA5ZDM2NTY2M2VjY2VlNjc4ZmViY2RiZDQyOTcwMjIzNmVlMjdjMmM4ODIwNDU4MjBkOGY2NGY3YWZjYTZhNTVkNGVlNmRlZDliMDIwMGJhYzY2NTFjYWY0YzdhMTkyMDIxMmI1YTAzYzliZjFkZjM2ODIwNDU4MjAxMTczOTcwODVjM2E2NTIzOTdhMzZmNDQ1ZDNhMzU5Njc5MzMzZGUwZGIyZmY3YmI3OWQwMmNkMDQ3NmI3ZTgxODIwNDU4MjA4MmMyOWI3ZDg0MDllMTk4NmU5NTU3NWUwNzhmOTlmNTY5ZDhiNTY4Nzc3ODI3YTBhNzRjZjRkNjVjNDg2MmZkODIwNDU4MjA5ZmI5MTViNGNjMTg2MGY1M2NkMzFiZGQ0NGE1ODc4MDRmZGRkYWY1MzYwYjI0YTg4ZGIzYjJiN2NkNzZiZDI1ODIwNDU4MjA5NTc3NDUzMWIwMzM5ZGNkODcwOTU3NzNhNjE0ZDZkNWMxNjRmMGFhMTY1MTU3YzY0ZDVmMTZhY2Q4ZjE3MjM3ODIwNDU4MjBlMGMyN2NmZThkYzIwMjNiZjExMWM2YzM4NTM4NTUxZWJhZGY5ZDg4ZTc2MTdjYWE4ZjIyN2E0OTlkYmQ3YmNjODMwMTgyMDQ1ODIwZDJhN2Q3YWRkYzQzMmZjNTFmMzcwZDc1ZTE5MTY2ZDBkN2E2NDM5Zjk5ODUyYjI0YjNiNWMxNzM4MmY1NTBhODgzMDI0NDc0Njk2ZDY1ODIwMzQ5ZTc5Yzg1ODdiMWI2Y2NlZTE3Njk3MzY5Njc2ZTYxNzQ3NTcyNjU1ODMwYWUyZTRjYmJiMTRkYjBlNTJmNTIyZDJkMTE2NDNhNWUzMTI5YWY2MjIxY2UyMmQwOGY0MjZhNWQyZTFhN2IzZjRkYTc3Mzc4Y2U1OWMyYzhkYzYwZTQ4MmZiNjNlYTBjNmE2NDY1NmM2NTY3NjE3NDY5NmY2ZWEyNjk3Mzc1NjI2ZTY1NzQ1ZjY5NjQ1ODFkNDNkY2FmMTE4MGRiODJmZGE3MDhjZTNhYzdhMDNhNjA2MGFiZGUxM2U5NTQ2YzYwZThjY2U2NWQwMjZiNjM2NTcyNzQ2OTY2Njk2MzYxNzQ2NTU5MDI5NGQ5ZDlmN2EyNjQ3NDcyNjU2NTgzMDE4MjA0NTgyMGExZDQ4NzQ0NWRmMzM5YmZkNzNhNGE1ODNiYTliYjQyNTdhNjZkZjFlZmE0ZWE4NjE4YzY4NWJhNmRlMzVjYWQ4MzAxODMwMTgyMDQ1ODIwMWU4YTdiYzMxMDA4NmNjYzdmODVmZGUxZmNiMmNkMWQwNDk5NWQyNWY3ZjM5MDQ1NWIyZmNmNTc0YjU0NmMxMDgzMDI0NjczNzU2MjZlNjU3NDgzMDE4MzAxODMwMTgyMDQ1ODIwYjgzMzE0OWU3MzQ1YjI5NjlkZGVmNWE4NWE1ZWMyYjkyYjlhYTQxMjE1NGU4YzZmZWFiZjZlNmY1NjRmYTRlYzgzMDE4MjA0NTgyMDQ2NmE3MDI4NmNmOWFjZTk4MDFjYTUzZTIyYWY2ZWUwNTlhMDk0ZmQ2MDQ5ODYwNmQ0ODRiNjg1NDA1ODMwN2Q4MzAxODMwMTgyMDQ1ODIwOGIyZjZjMTUwNzhhZTRkM2I5MzQ3MDkxNWNhNTNlMzczMzI3ZjM3ZWE3NGJhMWI4MTc3ZDk4NmJiNzliMzFhZTgzMDI1ODFkNDNkY2FmMTE4MGRiODJmZGE3MDhjZTNhYzdhMDNhNjA2MGFiZGUxM2U5NTQ2YzYwZThjY2U2NWQwMjgzMDE4MzAyNGY2MzYxNmU2OTczNzQ2NTcyNWY3MjYxNmU2NzY1NzM4MjAzNTgzMmQ5ZDlmNzgyODI0YTAwMDAwMDAwMDAwMDAwMDcwMTAxNGEwMDAwMDAwMDAwMDAwMDA3MDEwMTgyNGEwMDAwMDAwMDAyMTAwMDAwMDEwMTRhMDAwMDAwMDAwMjFmZmZmZjAxMDE4MzAyNGE3MDc1NjI2YzY5NjM1ZjZiNjU3OTgyMDM1ODg1MzA4MTgyMzAxZDA2MGQyYjA2MDEwNDAxODJkYzdjMDUwMzAxMDIwMTA2MGMyYjA2MDEwNDAxODJkYzdjMDUwMzAyMDEwMzYxMDBhNDYyZjM2OGZmZmE3NGJiOThmN2Q5ZjQ2ODBiNTgwNTAwOWUyOTFhZmMwMjhmZDg3ZWQyYzdlZDNiMmIyYzIxYTM3Y2I2ZTA4ZTEwMjhhNmQzMDhhOWVhZTY3NGYzNWIwZDczNWJkMzNjNWI2MjdlMTgyOTZkZTNjNTQwODQzYjhhZTZmODBiNzBjYjcxYzM3M2NhN2Q0NzdmYWEzYjk1YWNjZDhlZGQ4Yjk5NDQ1YWI1NmM2MzYxNDY2YTg3ZDQ4MjA0NTgyMDJjNTFkYjdiNTY1MGI3YTNkYmJiODUzMGE3NDQ5Y2M2ZjkwMTQ0Nzc4YjYyZjIwZjNjMjZkNzJlOTVlNTA2OTg4MjA0NTgyMGI3OGUxYTAwMDExYTFiMDRjMzUwNGQxNDc0NTNmMGVkYWJiMTZiMDM2ZjYxMDdjY2I3ODMzMDM0NTI3YjBiODM4MjA0NTgyMDEzNjZlZDY0YmU3YTg5MTY5MGYyM2Q5ZWUzNzIwMjQxNTcxMDljZDI1Y2UzZGQxZTEwOWIwMjdhOTdlYmEyYjU4MzAyNDQ3NDY5NmQ2NTgyMDM0OTk2ZmM4ZGMxOTVkYmExZWUxNzY5NzM2OTY3NmU2MTc0NzU3MjY1NTgzMDg4ZDBhYzVjNzZlMTU5NjZlYmVlMTFiMTg3ZGVlNjI4NjY2MjMwY2YwODEyN2IzNmM5NzJmNzkzNzE3YzY3YjZjZTIyZDNmYzEwYzg3ZGUwODM4ZTZmMjRiYzAwZDhjMzY0NzQ3MjY1NjU4MzAxODIwNDU4MjA4N2UzN2FkNjNhNzk2MDRlZWQ4MGE4NTYxZGRhNmUzMWM2NWM5ZWM1NjIyMjI2ZjU5NDgwYjEyY2YyYWQxMzg3ODMwMjQzNzM2OTY3ODMwMTgyMDQ1ODIwY2JmZmRhN2I3YTNmMzcwZjFjZjRhMTQ0MzQxN2U2YjEwMjU4ZWQxY2RmMTBkN2FkY2I4ZWY2MTM1ZmJkYjFiMDgzMDE4MjA0NTgyMGI3YTQ0MjFlYzdlNzAyZWIyYzM3MDJhNGU3YjhjNTJiZGJlNTZjMTNhZmI1NWVmYTRhMTBmYTkzOTMzY2RkOWM4MzAxODMwMTgyMDQ1ODIwOWM5NjI0NDQyMjk2ZTQ1NjAwMGYxOTViM2M3NDI1NjliODllNDA0YmQ4MGZmMjg2MmJlYjcxNDFkMDQ1NTdiZDgzMDE4MjA0NTgyMGEwZmZjN2RmZTYxMDBlMzRhZjc4MTMzOGU0NGIxZmQ3MWFkNGU0OWZmZDQ3NTU0YmEwNmNiZWQ0MWMyNWVhZjM4MzAxODMwMjU4MjBjMzdiNzk1NWM4MmQxMTVlOTQ3NGFlZTA5MTBmZDM1MWE1NDYxYzZhMmJjMmRlNjE1M2VmNDYzODkwNjUwM2VkODMwMTgyMDQ1ODIwNzA1MzU3NTQ3MDVjNWZjOWU3YzI3ZjEzZjA1NzY1NGU4OGQwOGQ1N2JlMjVmYWNjOTM4N2RjNjI5YmU5ZTE3NjgzMDI1ODIwMWI2ODJlZDJhNWU3MmM0NjQxYjI4YTZkYTBlOTA4MzRlNjRhMTBiNjg2ZWE1ZmI5ZjY1NWQwZWEzMTYxZjE1ZDgyMDM0MDgyMDQ1ODIwNGEzZWJkY2JlNDk1NzgyZGI3YTE5NDJiYmIzZWYxMjFiYWY4NGFjMDBkMjM4N2I1YWQwNTE5Y2U4YTM1N2U2MDgyMDQ1ODIwNDA4MGE1NWI4MWFlYzgxYjUxZjNjYzYzYjc0MmFlMTQxMDhjNTE0ZmRhYzRmYWZkZGEwMGExNjZlZGNkMzJhNCJ9XSwicHVibGljS2V5IjoiMzAzYzMwMGMwNjBhMmIwNjAxMDQwMTgzYjg0MzAxMDIwMzJjMDAwYTAwMDAwMDAwMDAwMDAwMDcwMTAxZWUwMWQ3MmMyYzdlYmE4OTNiZjgzMWQ0NDNkNzgwYjk1OGJkODg1ZTljMGI5MTNjNWRmNzJkMmNiOWRjODAyNyJ9';
const currentTimeNsOverride = BigInt(1719585273);
const iiCanisterIdOverride = 'jqajs-xiaaa-aaaad-aab5q-cai'; // using a II clone on mainnet

const expired = {
  address: 'undefined',
  proof:
    'eyJleHBpcmVzIjoiMjAyNC0wNi0xMVQyMDozMToyOS4zNjBaIiwibWVzc2FnZSI6IntcIm5vbmNlXCI6XCI2MTdkYmI5OTU3N2ExYTk4MmYxMWVmYTkzNzFmOWYxODdhZmQzZGZlNjI5ZWYzZDRiODI0Y2U1NGExODM3YjViXCIsXCJ0aW1lc3RhbXBcIjoxNzE4MTM3NTg5fSJ9.eyJkZWxlZ2F0aW9ucyI6W3siZGVsZWdhdGlvbiI6eyJwdWJrZXkiOiI3YjIyNjU3ODcwNjk3MjY1NzMyMjNhMjIzMjMwMzIzNDJkMzAzNjJkMzEzMTU0MzIzMDNhMzMzMTNhMzIzOTJlMzMzNjMwNWEyMjJjMjI2ZDY1NzM3MzYxNjc2NTIyM2EyMjdiNWMyMjZlNmY2ZTYzNjU1YzIyM2E1YzIyMzYzMTM3NjQ2MjYyMzkzOTM1MzczNzYxMzE2MTM5MzgzMjY2MzEzMTY1NjY2MTM5MzMzNzMxNjYzOTY2MzEzODM3NjE2NjY0MzM2NDY2NjUzNjMyMzk2NTY2MzM2NDM0NjIzODMyMzQ2MzY1MzUzNDYxMzEzODMzMzc2MjM1NjI1YzIyMmM1YzIyNzQ2OTZkNjU3Mzc0NjE2ZDcwNWMyMjNhMzEzNzMxMzgzMTMzMzczNTM4Mzk3ZDIyN2QiLCJleHBpcmF0aW9uIjoiMTdkODBlYjRjN2RhZmRiMSJ9LCJzaWduYXR1cmUiOiJkOWQ5ZjdhMjZiNjM2NTcyNzQ2OTY2Njk2MzYxNzQ2NTU5MDU2ZGQ5ZDlmN2EzNjQ3NDcyNjU2NTgzMDE4MzAxODMwMTgyMDQ1ODIwMjY3ZDEwOGI4MjUxNDljODg5MjI3ZjIyMGNhMjAxMTM4Y2U2MjFjMzFjN2MzY2YxNzQxMTdlNzAxNTExMGJiNzgzMDI0ODYzNjE2ZTY5NzM3NDY1NzI4MzAxODMwMTgyMDQ1ODIwYTc4YmI0NDNmMTAzYTMyZjhkMTQyNjY2NTYxNzc2ZTY0ZTQ3NDk5YmQ4YzM0MmE5YzJlZTdiZDc4MWQ1ZGMxNzgzMDE4MzAxODIwNDU4MjBjYTczZjUxYzMyMjYxZWZkMzJhMDY1M2E1NGI1YjcwZGY0OWVjODVmOTJiNTRlOTY1OGYyNWIwNGM4MjgyOTlhODMwMTgzMDE4MjA0NTgyMDc2Y2VkOGNmNDE0MjY1OWJlNjE2NjkzOGUyNDRlZjdmNjM5NjFkOTA1NzQzMjA1NDQyYzk4YjAzMDdlYWI2YzE4MzAxODMwMTgyMDQ1ODIwZjI0OTdiNmJkOTgxYzc0MjM3NThjOTNkMTcxOGQwNjQzNTNkNGU0NzA0NTQ2YWNjZWQwMzkyMDk2YmJjODVjZTgzMDI0YTAwMDAwMDAwMDA2MDAwN2IwMTAxODMwMTgzMDE4MzAyNGU2MzY1NzI3NDY5NjY2OTY1NjQ1ZjY0NjE3NDYxODIwMzU4MjBmZjgyMDBjMmEzN2Y3MmU4Mjc2ODU3ZTBhMDJhMzgyMmM3ZjRlODMwMjMwMzBjMzRhZWFkMWMwY2NhMDIyZmViODIwNDU4MjA2Y2NkNmJiMzFhNTQ3NjFkNGE1NmU5Y2ZkOGNiYTM4NGQ1YjhmYjQ3MTg0ZThjYTEzY2I3MGUwNGYyMjA5YWNlODIwNDU4MjA4ZTE4ZmUxMzFkODllNDA4M2U4YmM4N2U0NTA0MzgxZmM3ZmU5ODA5NWRiMjg3MzA5ZWJiMjFjM2JkYTJjMmMxODIwNDU4MjAzYmI5NGVhODY0ZmY4ZTk2ZjcxODU2YWRhNzk4OGQxNGFmMTAxNjYxNjA0N2U0OTljODYwNWM1NzRhNTYyZjBhODIwNDU4MjAzNjc3YzMxMzhmYWVhMTYzNDUyODMzMzJmNTIyYzRlZjJiODE4NWU2MzE1NDY1ZTc1ZmQwMmE3NjZhMjEzMjViODIwNDU4MjAwNzE5NjI5YzIxN2I2NDkwNTJiMGNiNWIxMmM2NzM2ZDY1YjY0Mjg5YzU3Y2EwMDg1ZTQ5MWMwNTM4ZjAxZTViODIwNDU4MjBhMGZmYzNhOTYzY2JlZTY2YTU3MjNhNGM1ZjU4MmVlMjBjOTVhMjFiNDgzODUzYWYzNDVkYTU2OWI5Yzk0NTA1ODIwNDU4MjBiOWI1ZDFlYjU4NTk3NjFhOGU5YTVlMWEzYTI3M2RjMGMyYWM5NWFmZDI2MDdhYjhmMzQ4Zjc3ODZiMDAyNTJhODMwMTgyMDQ1ODIwMDhkOTc3YmJjMzM1ZGY1NjZhZDMwMzVhNjUxNzVjOWE5NzkzYWM4MTUxMmRlNTdjY2U2ZDEwMzNiZTA0OWQwYjgzMDI0NDc0Njk2ZDY1ODIwMzQ5YzA5NGU4ZTI5ZGEyODNlYzE3Njk3MzY5Njc2ZTYxNzQ3NTcyNjU1ODMwYTMwMDU4MzQxYjYxZjcwOTdkMjM1NTA1Y2U5ODcwYjQ4MjdmMGMxMjNlYjdjNTgxNDAyMWY5ZDA1OTE4YTRlNDE4YjU1ODg0NTY3NWM5MWVjMTE0ZDBkZTFjNTI3NTNjNmE2NDY1NmM2NTY3NjE3NDY5NmY2ZWEyNjk3Mzc1NjI2ZTY1NzQ1ZjY5NjQ1ODFkMmM1NWIzNDdlY2YyNjg2YzgzNzgxZDZjNTlkMWI0M2U3YjRjYmE4ZGViNmMxYjM3NjEwN2YyY2QwMjZiNjM2NTcyNzQ2OTY2Njk2MzYxNzQ2NTU5MDI5NGQ5ZDlmN2EyNjQ3NDcyNjU2NTgzMDE4MjA0NTgyMDQyNjViOTY5ZjI0ZThjYjIzY2M4MTViYmFlMzc3OWRhOTJmODY5ZDNiN2NlNTAzY2UxNTczNDE1OWUxMzNiYWU4MzAxODMwMTgyMDQ1ODIwY2IyMjgzY2MwZGIzYWJkYmJlMTExMWE5OGM3MmY2OGNlMTVhMGNjNWMzNWM3MWQxOTA1YWI1NmMzNTk0MjljODgzMDI0NjczNzU2MjZlNjU3NDgzMDE4MzAxODMwMTgzMDE4MjA0NTgyMDg3MzlmYmJlZGQzZGVkYWE4ZmVmNDE4NzAzNjdjMDkwNWJkZTM3NmI2M2RkMzdlMmIxNzZmYjA4YjU4MjA1MmY4MzAxODIwNDU4MjBmOGMzZWFlMDM3N2VlMDA4NTkyMjNiZjFjNjIwMmY1ODg1YzRkY2RjOGZkMTNiMWQ0OGMzYzgzODY4ODkxOWJjODMwMTgzMDI1ODFkMmM1NWIzNDdlY2YyNjg2YzgzNzgxZDZjNTlkMWI0M2U3YjRjYmE4ZGViNmMxYjM3NjEwN2YyY2QwMjgzMDE4MzAyNGY2MzYxNmU2OTczNzQ2NTcyNWY3MjYxNmU2NzY1NzM4MjAzNTgzMmQ5ZDlmNzgyODI0YTAwMDAwMDAwMDA2MDAwMDAwMTAxNGEwMDAwMDAwMDAwNjAwMGFlMDEwMTgyNGEwMDAwMDAwMDAwNjAwMGIwMDEwMTRhMDAwMDAwMDAwMDZmZmZmZjAxMDE4MzAyNGE3MDc1NjI2YzY5NjM1ZjZiNjU3OTgyMDM1ODg1MzA4MTgyMzAxZDA2MGQyYjA2MDEwNDAxODJkYzdjMDUwMzAxMDIwMTA2MGMyYjA2MDEwNDAxODJkYzdjMDUwMzAyMDEwMzYxMDA5MDA3NTEyMDc3OGViMjFhNTMwYTAyYmNjNzYzZTdmNGExOTI5MzM1MDY5NjZhZjdiNTRjMTBhNGQyYjI0ZGU2YTg2YjIwMGUzNDQwYmFlNjI2N2JmNGM0ODhkOWExMWQwNDcyYzM4YzFiNjIyMTE5OGY5OGU0ZTY4ODJiYTM4YTVhNGUzYWE1YWZjZTg5OWI3ZjgyNWVkOTVhZGZhMTI2Mjk2ODgwNzM1NTZmMjc0NzUyNzIxM2U4ZDczZTQwY2U4MjA0NTgyMDM2ZjNjZDI1N2Q5MGZiMzhlNDI1OTdmMTkzYTVlMDMxZGJkNTg1YjYyOTI3OTNiYjA0ZGI0Nzk0ODAzY2UwNmU4MjA0NTgyMDQ0ODIyMzRmMGQwNmUyZmJjOGQ5ZDk3Y2ZlNDg0ZDhiMmM3ZjUwZDk4OTBiMTk0MTg5NDk0Y2UyMDcyNDA0MDc4MjA0NTgyMGI3OGUxYTAwMDExYTFiMDRjMzUwNGQxNDc0NTNmMGVkYWJiMTZiMDM2ZjYxMDdjY2I3ODMzMDM0NTI3YjBiODM4MjA0NTgyMDllNTY0MWY0YWFjNDI2OGZiMjYzYjM1ZDZmOGE0Zjc1MzQzMGNiOWZlYWQ2MjBkYzdjZjY3NmY3NjJiZjAwNTg4MzAyNDQ3NDY5NmQ2NTgyMDM0OWRmODBhZmI4ODdlMGU2ZWIxNzY5NzM2OTY3NmU2MTc0NzU3MjY1NTgzMDgyZmI1MTEyMTY1Zjg1OTk4MjE1NGI1MjYyYWQyNDk2YTQ4OTYzY2ZjYzlhZDkyZTI2Yjc5ZjQ2MTk2ZjlhZGZkNzA3ODQxYTg2NzY1MzEzNTc3NzAzMDI2NmQ4Y2M0ZTY0NzQ3MjY1NjU4MzAxODIwNDU4MjAyNDkyYmMwNDBlNjI0MDNiYWQ5MWM5MTcwYzk3ZjI4MWE0N2FlOTJiN2E5NWQ0ZGYwNzRmNDIzYjA2MGYzNjM5ODMwMjQzNzM2OTY3ODMwMjU4MjAyYzFhYmVjZmRkMTEwODA4MGQzNDBlMDZkYmY1OTEyY2M4NmEwNjlmNTc3NzU1MTVjM2YyNjBmMGU0Yzk1ZWM4ODMwMTgyMDQ1ODIwYzI5NzE3YjkzZTY0ZjQ5MTQ1MjNiMmMzZTQ4MjI1NzJlYTIyYzgxYmY5MGIyMDQ0NDIzMmIyYWU3OTZkYWQwOTgzMDI1ODIwOWU4ZGM3ZGEzYzQ2OTc5ZmQ4MWYzNWQ5ODIwODdjOWU5ZDU3NmRhZmE5NmQ4NTIxNGM3OWRhNDJkMmI1NDk3YjgyMDM0MCJ9XSwicHVibGljS2V5IjoiMzAzYzMwMGMwNjBhMmIwNjAxMDQwMTgzYjg0MzAxMDIwMzJjMDAwYTAwMDAwMDAwMDA2MDAwN2IwMTAxYTYyZDk0MWIyZDYxNjdiNzM1MDE2OTU4Y2VhNmRkODIxZGY4YjJmY2FlMDYwNzQ0NTBkMjg5MmJhZDExNDNjMCJ9',
};

describe('prove-icp-principal', () => {
  afterEach(() => jest.restoreAllMocks());

  let message: string;
  beforeEach(() => {
    message = JSON.stringify(messageFixture);
  });

  it('creates a wallet ownership proof when a signer function is provided', async () => {
    // const proof = await create({
    //   message,
    // });
    // expect(proof).toMatch(/.*\..*/); // the message is a base64 version of the signature concatenated with the message
  });

  it('verifies wallet ownership with provided signer function', async () => {
    await expect(verify(principal, proofJWTFixture, { message: messageFixture }, currentTimeNsOverride)).resolves.not.toThrow();
  });

  // it('throws an error if the transaction is signed with a different key', async () => {
  //   await expect(verify(someOtherKey.address, proof, { message })).rejects.toThrow();
  // });

  it('throws an error if the proof is expired', async () => {
    await expect(verify(principal, expired.proof, { message: 'test' }, undefined)).rejects.toThrow(
      'Verification failed'
    );
  });

  it("throws an error if the message doesn't match", async () => {
    await expect(verify(principal, proofJWTFixture, { message: 'wrong' }, currentTimeNsOverride)).rejects.toThrow(
      'Bad message'
    );
  });
});